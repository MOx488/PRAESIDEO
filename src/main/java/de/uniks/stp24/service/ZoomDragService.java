package de.uniks.stp24.service;

import de.uniks.stp24.model.CastleType;
import javafx.geometry.Point2D;

import javax.inject.Inject;
import javax.inject.Singleton;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Singleton
public class ZoomDragService {

    private Map<CastleType, List<List<Point2D>>> castleTypeToPolygonMap;

    @Inject
    public ZoomDragService() {
        this.populatePolygons();
    }

    private void populatePolygons() {
        if (this.castleTypeToPolygonMap != null) {
            return;
        }

        this.castleTypeToPolygonMap = new HashMap<>();

        this.populateMountainPolygons();
        this.populateSandPolygons();
        this.populateWaterPolygons();
        this.populateForestPolygons();
    }

    private void populateMountainPolygons() {
        this.castleTypeToPolygonMap.put(CastleType.MOUNTAIN, List.of(
                //top left mountain
                List.of(
                        new Point2D(490.0683333333333, 303.3383333333333),
                        new Point2D(761.6866666666666, 451.3483333333333),
                        new Point2D(906.3883333333333, 347.7683333333333),
                        new Point2D(1070.6883333333333, 287.525),
                        new Point2D(1048.7816666666665, 205.375),
                        new Point2D(1150.1, 117.74833333333332),
                        new Point2D(1092.595, 32.86),
                        new Point2D(703.0883333333333, 45.074999999999996)
                ),
                List.of(
                        new Point2D(2133.1616666666664, 19.168333333333333),
                        new Point2D(1922.31, 287.525),
                        new Point2D(2220.7883333333334, 375.15166666666664),
                        new Point2D(2385.088333333333, 498.37666666666667),
                        new Point2D(2439.855, 692.7983333333333),
                        new Point2D(2867.035, 810.5466666666666),
                        new Point2D(2910.8483333333334, 610.6483333333333),
                        new Point2D(3272.308333333333, 651.7233333333332),
                        new Point2D(3264.0933333333332, 418.965),
                        new Point2D(2869.773333333333, 388.8433333333333),
                        new Point2D(2584.9866666666667, 254.665),
                        new Point2D(2628.7999999999997, 30.121666666666666)
                ),
                List.of(
                        new Point2D(873.5283333333333, 1330.83),
                        new Point2D(627.0783333333333, 1511.56),
                        new Point2D(514.8066666666666, 1862.0666666666666),
                        new Point2D(1062.4733333333334, 1867.5433333333333),
                        new Point2D(1188.4366666666665, 1700.5049999999999),
                        new Point2D(1333.5683333333332, 1517.0366666666666),
                        new Point2D(1128.1933333333334, 1322.615)
                ),
                List.of(
                        new Point2D(1549.8966666666665, 1314.3999999999999),
                        new Point2D(1541.6816666666666, 1530.7283333333332),
                        new Point2D(1396.55, 1853.8516666666665),
                        new Point2D(1998.9833333333331, 1864.8049999999998),
                        new Point2D(2040.0583333333332, 1686.8133333333333),
                        new Point2D(2020.8899999999999, 1582.7566666666667),
                        new Point2D(1927.7866666666666, 1549.8966666666665),
                        new Point2D(1974.3383333333331, 1421.195),
                        new Point2D(1840.1599999999999, 1328.0916666666667)
                )
        ));
    }

    private void populateSandPolygons() {
        this.castleTypeToPolygonMap.put(CastleType.SAND, List.of(
                //top left mountain
                List.of(
                        new Point2D(2579.5099999999998, 1862.0666666666666),
                        new Point2D(2637.015, 1684.0749999999998),
                        new Point2D(2815.0066666666667, 1590.9716666666666),
                        new Point2D(2971.0916666666667, 1563.5883333333331),
                        new Point2D(2971.0916666666667, 1500.6066666666666),
                        new Point2D(2806.7916666666665, 1393.8116666666665),
                        new Point2D(2765.7166666666667, 1265.11),
                        new Point2D(2836.913333333333, 1210.3433333333332),
                        new Point2D(3001.213333333333, 1248.6799999999998),
                        new Point2D(3088.8399999999997, 1207.605),
                        new Point2D(3220.2799999999997, 1191.175),
                        new Point2D(3217.5416666666665, 1141.885),
                        new Point2D(3097.055, 1054.2583333333332),
                        new Point2D(3091.5783333333334, 983.0616666666666),
                        new Point2D(3162.7749999999996, 884.4816666666666),
                        new Point2D(3023.12, 720.1816666666666),
                        new Point2D(3042.288333333333, 640.77),
                        new Point2D(3165.5133333333333, 629.8166666666666),
                        new Point2D(3247.663333333333, 648.985),
                        new Point2D(3244.9249999999997, 684.5833333333333),
                        new Point2D(3151.8216666666667, 665.415),
                        new Point2D(3080.625, 692.7983333333333),
                        new Point2D(3108.008333333333, 772.2099999999999),
                        new Point2D(3214.8033333333333, 873.5283333333333),
                        new Point2D(3149.083333333333, 994.015),
                        new Point2D(3154.56, 1054.2583333333332),
                        new Point2D(3233.9716666666664, 1109.0249999999999),
                        new Point2D(3261.355, 1174.745),
                        new Point2D(3242.1866666666665, 1248.6799999999998),
                        new Point2D(3127.1766666666663, 1259.6333333333332),
                        new Point2D(3009.4283333333333, 1308.9233333333332),
                        new Point2D(2894.418333333333, 1276.0633333333333),
                        new Point2D(2823.2216666666664, 1295.2316666666666),
                        new Point2D(2864.2966666666666, 1369.1666666666665),
                        new Point2D(2946.4466666666667, 1429.4099999999999),
                        new Point2D(3028.5966666666664, 1500.6066666666666),
                        new Point2D(3064.1949999999997, 1604.6633333333332),
                        new Point2D(2905.3716666666664, 1659.4299999999998),
                        new Point2D(2806.7916666666665, 1695.0283333333332),
                        new Point2D(2689.043333333333, 1760.7483333333332),
                        new Point2D(2667.1366666666663, 1851.1133333333332)
                ),
                List.of(
                        new Point2D(3247.663333333333, 424.44166666666666),
                        new Point2D(3055.98, 410.75),
                        new Point2D(2853.3433333333332, 290.2633333333333),
                        new Point2D(2749.2866666666664, 158.82333333333332),
                        new Point2D(2683.5666666666666, 24.645),
                        new Point2D(2875.25, 13.691666666666666),
                        new Point2D(2779.4083333333333, 76.67333333333333),
                        new Point2D(2856.0816666666665, 167.03833333333333),
                        new Point2D(2910.8483333333334, 262.88),
                        new Point2D(3039.5499999999997, 334.07666666666665),
                        new Point2D(3242.1866666666665, 377.89)
                ),

                List.of(
                        new Point2D(512.0683333333333, 1859.3283333333331),
                        new Point2D(605.1716666666666, 1547.1583333333333),
                        new Point2D(668.1533333333333, 1330.83),
                        new Point2D(435.395, 1177.4833333333333),
                        new Point2D(432.65666666666664, 1125.455),
                        new Point2D(553.1433333333333, 1004.9683333333332),
                        new Point2D(498.37666666666667, 865.3133333333333),
                        new Point2D(317.64666666666665, 780.425),
                        new Point2D(350.50666666666666, 668.1533333333333),
                        new Point2D(575.05, 591.48),
                        new Point2D(596.9566666666666, 465.51666666666665),
                        new Point2D(429.9183333333333, 364.1983333333333),
                        new Point2D(605.1716666666666, 197.16),
                        new Point2D(616.125, 125.96333333333332),
                        new Point2D(484.685, 87.62666666666667),
                        new Point2D(550.405, 19.168333333333333),
                        new Point2D(479.2083333333333, 19.168333333333333),
                        new Point2D(380.62833333333333, 98.58),
                        new Point2D(468.255, 147.87),
                        new Point2D(531.2366666666667, 186.20666666666665),
                        new Point2D(323.12333333333333, 377.89),
                        new Point2D(476.46999999999997, 517.545),
                        new Point2D(462.7783333333333, 558.62),
                        new Point2D(224.54333333333332, 659.9383333333333),
                        new Point2D(205.375, 826.9766666666666),
                        new Point2D(380.62833333333333, 895.435),
                        new Point2D(429.9183333333333, 969.37),
                        new Point2D(325.8616666666666, 1117.24),
                        new Point2D(265.61833333333334, 1191.175),
                        new Point2D(547.6666666666666, 1399.2883333333332),
                        new Point2D(492.9, 1533.4666666666667),
                        new Point2D(446.3483333333333, 1714.1966666666665),
                        new Point2D(413.4883333333333, 1862.0666666666666)
                )
        ));
    }

    private void populateWaterPolygons() {
        this.castleTypeToPolygonMap.put(CastleType.WATER, List.of(
                //top left mountain
                List.of(
                        new Point2D(479.2083333333333, 19.168333333333333),
                        new Point2D(369.67499999999995, 90.365),
                        new Point2D(517.545, 169.77666666666667),
                        new Point2D(317.64666666666665, 353.245),
                        new Point2D(465.51666666666665, 523.0216666666666),
                        new Point2D(221.80499999999998, 659.9383333333333),
                        new Point2D(197.16, 818.7616666666667),
                        new Point2D(399.7966666666666, 950.2016666666666),
                        new Point2D(273.8333333333333, 1188.4366666666665),
                        new Point2D(544.9283333333333, 1388.335),
                        new Point2D(435.395, 1733.365),
                        new Point2D(402.53499999999997, 1856.59),
                        new Point2D(24.645, 1840.1599999999999),
                        new Point2D(10.953333333333333, 13.691666666666666)
                ),

                List.of(
                        new Point2D(1675.86, 1073.4266666666665),
                        new Point2D(1486.915, 1035.09),
                        new Point2D(1410.2416666666666, 1032.3516666666667),
                        new Point2D(1240.465, 799.5933333333332),
                        new Point2D(1245.9416666666666, 703.7516666666667),
                        new Point2D(1161.0533333333333, 654.4616666666666),
                        new Point2D(1229.5116666666665, 618.8633333333333),
                        new Point2D(1443.1016666666667, 711.9666666666666),
                        new Point2D(1489.6533333333332, 783.1633333333333)
                )
        ));

    }

    private void populateForestPolygons() {
        this.castleTypeToPolygonMap.put(CastleType.FOREST, List.of(
                List.of(
                        new Point2D(577.7883333333333, 492.9),
                        new Point2D(547.6666666666666, 605.1716666666666),
                        new Point2D(339.55333333333334, 690.06),
                        new Point2D(336.815, 783.1633333333333),
                        new Point2D(487.4233333333333, 835.1916666666666),
                        new Point2D(536.7133333333333, 936.51),
                        new Point2D(429.9183333333333, 1152.8383333333334),
                        new Point2D(703.7516666666667, 1404.7649999999999),
                        new Point2D(835.1916666666666, 1319.8766666666666),
                        new Point2D(1048.7816666666665, 1308.9233333333332),
                        new Point2D(1073.4266666666665, 1213.0816666666667),
                        new Point2D(840.6683333333333, 1087.1183333333333),
                        new Point2D(777.6866666666666, 1144.6233333333332),
                        new Point2D(895.435, 1213.0816666666667),
                        new Point2D(742.0883333333333, 1229.5116666666665),
                        new Point2D(596.9566666666666, 1114.5016666666666),
                        new Point2D(654.4616666666666, 1040.5666666666666),
                        new Point2D(780.425, 1048.7816666666665),
                        new Point2D(758.5183333333333, 966.6316666666667),
                        new Point2D(665.415, 900.9116666666666),
                        new Point2D(766.7333333333333, 848.8833333333333),
                        new Point2D(725.6583333333333, 813.285),
                        new Point2D(613.3866666666667, 807.8083333333333),
                        new Point2D(616.125, 725.6583333333333),
                        new Point2D(690.06, 659.9383333333333)
                ),
                List.of(
                        new Point2D(1100.81, 821.5),
                        new Point2D(972.1083333333332, 972.1083333333332),
                        new Point2D(955.6783333333333, 1054.2583333333332),
                        new Point2D(1021.3983333333333, 1109.0249999999999),
                        new Point2D(1122.7166666666667, 1221.2966666666666),
                        new Point2D(1174.745, 1273.325),
                        new Point2D(1287.0166666666667, 1344.5216666666665),
                        new Point2D(1347.26, 1270.5866666666666),
                        new Point2D(1358.2133333333334, 1204.8666666666666),
                        new Point2D(1243.2033333333334, 1103.5483333333332),
                        new Point2D(1289.7549999999999, 1035.09),
                        new Point2D(1234.9883333333332, 994.015),
                        new Point2D(1166.53, 1010.4449999999999),
                        new Point2D(1119.9783333333332, 980.3233333333333),
                        new Point2D(1152.8383333333334, 925.5566666666666),
                        new Point2D(1234.9883333333332, 846.145)
                ),

                List.of(
                        new Point2D(1497.8683333333333, 1284.2783333333332),
                        new Point2D(1374.6433333333332, 1344.5216666666665),
                        new Point2D(1273.325, 1695.0283333333332),
                        new Point2D(1391.0733333333333, 1771.7016666666666),
                        new Point2D(1519.7749999999999, 1705.981666666)
                ),

                List.of(
                        new Point2D(1497.8683333333333, 1284.2783333333332),
                        new Point2D(1374.6433333333332, 1344.5216666666665),
                        new Point2D(1273.325, 1695.0283333333332),
                        new Point2D(1391.0733333333333, 1771.7016666666666),
                        new Point2D(1519.7749999999999, 1705.9816666666666),
                        new Point2D(1588.2333333333333, 1311.6616666666666),
                        new Point2D(2051.0116666666668, 1862.0666666666666),
                        new Point2D(2037.32, 1670.3833333333332),
                        new Point2D(1966.1233333333332, 1410.2416666666666),
                        new Point2D(1618.355, 1267.8483333333334),
                        new Point2D(1574.5416666666665, 1155.5766666666666),
                        new Point2D(1418.4566666666665, 1169.2683333333332),
                        new Point2D(1495.1299999999999, 1018.66),
                        new Point2D(1758.01, 1095.3333333333333),
                        new Point2D(1812.7766666666666, 1161.0533333333333),
                        new Point2D(1777.1783333333333, 1199.3899999999999),
                        new Point2D(2029.1049999999998, 1278.8016666666665),
                        new Point2D(2163.2833333333333, 1410.2416666666666),
                        new Point2D(2083.8716666666664, 1566.3266666666666),
                        new Point2D(2311.153333333333, 1856.59)
                ),

                List.of(
                        new Point2D(2406.995, 1862.0666666666666),
                        new Point2D(2272.8166666666666, 1744.3183333333332),
                        new Point2D(2417.9483333333333, 1462.27),
                        new Point2D(2289.2466666666664, 1432.1483333333333),
                        new Point2D(2239.9566666666665, 1325.3533333333332),
                        new Point2D(2103.04, 1122.7166666666667),
                        new Point2D(1963.385, 980.3233333333333),
                        new Point2D(2220.7883333333334, 906.3883333333333),
                        new Point2D(2338.5366666666664, 977.5849999999999),
                        new Point2D(2294.7233333333334, 1114.5016666666666),
                        new Point2D(2338.5366666666664, 1224.0349999999999),
                        new Point2D(2434.378333333333, 1328.0916666666667),
                        new Point2D(2579.5099999999998, 1393.8116666666665),
                        new Point2D(2472.7149999999997, 1270.5866666666666),
                        new Point2D(2579.5099999999998, 1218.5583333333332),
                        new Point2D(2516.528333333333, 1141.885),
                        new Point2D(2587.725, 1098.0716666666667),
                        new Point2D(2710.95, 1136.4083333333333),
                        new Point2D(2749.2866666666664, 1224.0349999999999),
                        new Point2D(2787.623333333333, 1385.5966666666666),
                        new Point2D(2949.185, 1544.4199999999998),
                        new Point2D(2683.5666666666666, 1648.4766666666667),
                        new Point2D(2574.0333333333333, 1859.3283333333331)
                ),

                List.of(
                        new Point2D(2968.353333333333, 610.6483333333333),
                        new Point2D(3127.1766666666663, 881.7433333333333),
                        new Point2D(3083.3633333333332, 1062.4733333333334),
                        new Point2D(3190.1583333333333, 1174.745),
                        new Point2D(2973.83, 1248.6799999999998),
                        new Point2D(2888.9416666666666, 1158.3149999999998),
                        new Point2D(2795.838333333333, 1188.4366666666665),
                        new Point2D(2683.5666666666666, 1056.9966666666667),
                        new Point2D(2762.978333333333, 950.2016666666666),
                        new Point2D(2667.1366666666663, 884.4816666666666),
                        new Point2D(2464.5, 796.8549999999999),
                        new Point2D(2259.125, 717.4433333333333),
                        new Point2D(2116.7316666666666, 668.1533333333333),
                        new Point2D(2119.47, 591.48),
                        new Point2D(2020.8899999999999, 523.0216666666666),
                        new Point2D(1873.02, 468.255),
                        new Point2D(1738.8416666666665, 388.8433333333333),
                        new Point2D(1730.6266666666666, 243.71166666666664),
                        new Point2D(1856.59, 240.97333333333333),
                        new Point2D(1955.1699999999998, 282.04833333333335),
                        new Point2D(2259.125, 391.58166666666665),
                        new Point2D(2368.6583333333333, 495.6383333333333),
                        new Point2D(2448.0699999999997, 657.1999999999999),
                        new Point2D(2582.248333333333, 731.135),
                        new Point2D(2784.8849999999998, 774.9483333333333),
                        new Point2D(2897.1566666666663, 747.5649999999999)
                ),

                List.of(
                        new Point2D(1618.355, 249.18833333333333),
                        new Point2D(1454.0549999999998, 262.88),
                        new Point2D(1333.5683333333332, 194.42166666666665),
                        new Point2D(1333.5683333333332, 76.67333333333333),
                        new Point2D(1125.455, 68.45833333333333),
                        new Point2D(1119.9783333333332, 5.476666666666667),
                        new Point2D(1930.5249999999999, 19.168333333333333),
                        new Point2D(1812.7766666666666, 123.225),
                        new Point2D(1659.4299999999998, 158.82333333333332)
                )
        ));
    }

    public CastleType determineCastleType(double x, double y) {
        for (Map.Entry<CastleType, List<List<Point2D>>> entry : castleTypeToPolygonMap.entrySet()) {
            CastleType castleType = entry.getKey();
            List<List<Point2D>> polygons = entry.getValue();

            for (List<Point2D> polygon : polygons) {
                if (this.isPointInPolygon(polygon, x, y)) {
                    return castleType;
                }
            }
        }

        //default type grass
        return CastleType.GRASS;
    }

    private boolean isPointInPolygon(List<Point2D> polygon, double x, double y) {
        boolean isInside = false;

        int length = polygon.size();

        int i = 0;
        int j = length - 1;
        for (; i < length; j = i++) {
            final double polygoniX = polygon.get(i).getX();
            final double polygoniY = polygon.get(i).getY();

            final double polygonjX = polygon.get(j).getX();
            final double polygonjY = polygon.get(j).getY();

            if (((polygoniY >= y) != (polygonjY >= y)) && (x <= (polygonjX - polygoniX) * (y - polygoniY) / (polygonjY - polygoniY) + polygoniX)) {
                isInside = !isInside;
            }
        }

        return isInside;
    }
}
